<div class="bg-white p-6 rounded-lg shadow mb-6">
  <h2 class="text-xl font-bold mb-4">Resumo do Dia <%= @time_sheet.date.strftime("%d/%m/%Y") %></h2>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-gray-50 p-4 rounded-lg">
      <h3 class="text-gray-500 mb-2">Horas Trabalhadas</h3>
      <p class="text-2xl font-bold <%= @time_sheet.total_hours && @time_sheet.total_hours.to_f >= 8 ? 'text-green-600' : 'text-gray-900' %>">
        <%= format_hours(@time_sheet.total_hours) %>
      </p>
    </div>

    <div class="mt-4">
      <% if @time_sheet.within_tolerance? %>
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded">
          <p class="font-medium">Dentro da tolerância</p>
          <p class="text-sm">Este registro está dentro da tolerância de 15 minutos e não requer justificativa.</p>
        </div>
      <% else %>
        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded">
          <p class="font-medium">Fora da tolerância</p>
          <p class="text-sm">Este registro está fora da tolerância de 15 minutos (diferença de <%= ((@time_sheet.total_hours.to_f - 8.0).abs * 60).round %> minutos). É necessário adicionar uma justificativa.</p>
        </div>
      <% end %>
    </div>

    <div class="bg-gray-50 p-4 rounded-lg">
      <h3 class="text-gray-500 mb-2">Status da Jornada</h3>
      <% if @time_sheet.approval_status == 'aprovado' %>
        <p class="text-2xl font-bold text-green-600">Aprovado</p>
      <% elsif @time_sheet.status == 'completo' %>
        <p class="text-2xl font-bold text-blue-600">Completo</p>
      <% else %>
        <p class="text-2xl font-bold text-yellow-600">Incompleto</p>
      <% end %>
    </div>

    <div class="mt-6 bg-white p-4 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4">Justificativa</h2>

      <% if @time_sheet.justification.present? %>
        <div class="bg-gray-100 p-4 rounded-lg mb-4">
          <p class="text-gray-800"><%= @time_sheet.justification %></p>

          <div class="mt-2">
            <% case @time_sheet.justification_status %>
            <% when 'aprovada' %>
              <span class="bg-green-100 text-green-700 px-2 py-1 rounded">Justificativa aprovada</span>
            <% when 'rejeitada' %>
              <span class="bg-red-100 text-red-700 px-2 py-1 rounded">Justificativa rejeitada</span>
            <% when 'pendente' %>
              <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Justificativa pendente de análise</span>
            <% else %>
              <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded">Sem status</span>
            <% end %>
          </div>

          <% if current_user.role == 'admin' || current_user.role == 'gestor' %>
            <div class="mt-4">
              <%= button_to review_justification_time_sheet_path(@time_sheet, status: 'aprovada'), method: :patch, class: "bg-green-500 text-white px-4 py-2 rounded mr-2 inline-block" do %>
                Aprovar justificativa
              <% end %>

              <%= button_to review_justification_time_sheet_path(@time_sheet, status: 'rejeitada'), method: :patch, class: "bg-red-500 text-white px-4 py-2 rounded inline-block" do %>
                Rejeitar justificativa
              <% end %>
            </div>
          <% end %>
        </div>
      <% elsif @time_sheet.status == 'completo' && @time_sheet.approval_status != 'aprovado' && !@time_sheet.within_tolerance? %>
        <%= form_with model: @time_sheet, url: add_justification_time_sheet_path(@time_sheet), method: :patch do |f| %>
          <div class="mb-4">
            <%= f.label :justification, "Adicionar justificativa", class: "block text-gray-700 font-medium mb-2" %>
            <%= f.text_area :justification, rows: 4, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
          </div>

          <div class="flex justify-between">
            <%= link_to "Cancelar", time_sheets_path, class: "bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded" %>
            <%= f.submit "Enviar justificativa", class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded" %>
          </div>
        <% end %>
      <% elsif @time_sheet.within_tolerance? %>
        <div class="bg-green-100 p-4 rounded-lg">
          <p class="text-green-700">Este registro está dentro da tolerância de 15 minutos e não requer justificativa.</p>
        </div>
      <% else %>
        <p class="text-gray-500">Nenhuma justificativa adicionada.</p>
      <% end %>
    </div>

    <div class="bg-gray-50 p-4 rounded-lg">
      <h3 class="text-gray-500 mb-2">Registros</h3>
      <p class="text-2xl font-bold text-gray-900"><%= @time_sheet.time_entries.count %> de 4</p>
    </div>
  </div>
</div>