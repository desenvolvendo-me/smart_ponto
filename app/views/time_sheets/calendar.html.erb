<div class="flex items-center mb-4">
  <%= link_to time_sheets_path, class: "text-2xl" do %>
    <i class="fas fa-arrow-left"></i>
  <% end %>
  <h1 class="text-2xl font-bold ml-4">Calendário de Ponto</h1>
</div>

<div class="flex justify-between items-center mb-4">
  <div class="flex space-x-4">
    <%= link_to "Lista", time_sheets_path, class: "bg-gray-200 text-gray-700 px-4 py-2 rounded" %>
    <%= link_to "Calendário", calendar_time_sheets_path, class: "bg-gray-200 text-gray-700 px-4 py-2 rounded" %>
  </div>
  <div class="flex space-x-4">
    <%= link_to export_time_sheets_path(format: :csv), class: "bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded flex items-center" do %>
      <i class="fas fa-download mr-2"></i> Exportar
    <% end %>
    <%= button_to quick_register_time_entries_path, method: :post, class: "bg-black text-white px-4 py-2 rounded flex items-center" do %>
      <i class="fas fa-plus mr-2"></i> Registrar Ponto
    <% end %>
  </div>
</div>

<div class="bg-white p-4 rounded-lg shadow">
  <div class="grid grid-cols-7 gap-2 mb-2">
    <% %w(Dom Seg Ter Qua Qui Sex Sab).each do |day| %>
      <div class="text-center font-bold"><%= day %></div>
    <% end %>
  </div>

  <div class="grid grid-cols-7 gap-2">
    <% first_day = Date.today.beginning_of_month %>
    <% last_day = Date.today.end_of_month %>

    <% # Preencher dias vazios do início do mês %>
    <% first_day.wday.times do %>
      <div class="h-24 p-1 border rounded bg-gray-50"></div>
    <% end %>

    <% # Dias do mês %>
    <% (first_day..last_day).each do |date| %>
      <% time_sheet = @time_sheets.find { |ts| ts.date == date } %>
      <div class="h-24 p-1 border rounded <%= date == Date.today ? 'bg-blue-50 border-blue-300' : 'bg-white' %>">
        <div class="flex justify-between">
          <span class="font-semibold"><%= date.day %></span>
          <% if time_sheet&.approval_status == 'aprovado' %>
            <span class="text-xs bg-green-100 text-green-700 px-1 rounded">✓</span>
          <% elsif time_sheet&.status == 'completo' %>
            <span class="text-xs bg-blue-100 text-blue-700 px-1 rounded">✓</span>
          <% end %>
        </div>

        <% if time_sheet %>
          <div class="mt-1 text-xs">
            <% if time_sheet.total_hours %>
              <span class="block"><%= time_sheet.total_hours.to_i %>h <%= ((time_sheet.total_hours - time_sheet.total_hours.to_i) * 60).to_i %>min</span>
            <% end %>
            <% time_sheet.time_entries.order(:time).first(2).each do |entry| %>
              <span class="block text-gray-600"><%= entry.time.strftime("%H:%M") %> <%= entry.entry_type == 'entrada' ? 'E' : 'S' %></span>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>

    <% # Preencher dias vazios do final do mês %>
    <% (6 - last_day.wday).times do %>
      <div class="h-24 p-1 border rounded bg-gray-50"></div>
    <% end if last_day.wday < 6 %>
  </div>
</div>
